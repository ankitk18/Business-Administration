//////////////////////////////////////////////////////
// PRISMA CLIENT GENERATOR
//////////////////////////////////////////////////////

generator client {
provider = "prisma-client"
output   = "../generated/prisma"
}

//////////////////////////////////////////////////////
// DATABASE CONNECTION
//////////////////////////////////////////////////////

datasource db {
provider = "postgresql"
}

//////////////////////////////////////////////////////
// COMPANY (TENANT)
//////////////////////////////////////////////////////

model Company {
id          String   @id @default(cuid())
name        String
slug        String   @unique
plan        PlanType @default(FREE)
status      Status   @default(ACTIVE)

createdAt   DateTime @default(now())
updatedAt   DateTime @updatedAt

users       User[]
departments Department[]
employees   Employee[]
customers   Customer[]
payments    Payment[]

@@map("companies")
}

//////////////////////////////////////////////////////
// DEPARTMENT
//////////////////////////////////////////////////////

model Department {
id          String   @id @default(cuid())
name        String
description String?

companyId   String
company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

users       User[]
employees   Employee[]

createdAt   DateTime @default(now())
updatedAt   DateTime @updatedAt

@@unique([companyId, name])
@@index([companyId])

@@map("departments")
}

//////////////////////////////////////////////////////
// USER (AUTHENTICATION)
//////////////////////////////////////////////////////

model User {
id           String   @id @default(cuid())

email        String
password     String
name         String

role         UserRole

companyId    String
company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

departmentId String?
department   Department? @relation(fields: [departmentId], references: [id])

employee     Employee?

createdAt    DateTime @default(now())
updatedAt    DateTime @updatedAt

@@unique([companyId, email])
@@index([companyId])
@@index([departmentId])

@@map("users")
}

//////////////////////////////////////////////////////
// EMPLOYEE (PROFILE DATA)
//////////////////////////////////////////////////////

model Employee {
id            String   @id @default(cuid())

employeeCode  String
name          String
email         String?
phone         String?

position      String
salary        Decimal? @db.Decimal(10,2)

joinDate      DateTime

userId        String   @unique
user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

departmentId  String
department    Department @relation(fields: [departmentId], references: [id])

companyId     String
company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

createdAt     DateTime @default(now())
updatedAt     DateTime @updatedAt

@@unique([companyId, employeeCode])

@@index([companyId])
@@index([departmentId])
@@index([userId])

@@map("employees")
}

//////////////////////////////////////////////////////
// CUSTOMER
//////////////////////////////////////////////////////

model Customer {
id          String   @id @default(cuid())

name        String
email       String?
phone       String?
address     String?

companyId   String
company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

createdAt   DateTime @default(now())
updatedAt   DateTime @updatedAt

deletedAt   DateTime?

@@index([companyId])

@@map("customers")
}

//////////////////////////////////////////////////////
// PAYMENT
//////////////////////////////////////////////////////

model Payment {
id                 String        @id @default(cuid())

amount             Decimal       @db.Decimal(10,2)

method             PaymentMethod
status             PaymentStatus @default(PENDING)

razorpayPaymentId  String?
razorpayOrderId    String?
razorpaySignature  String?

paidAt             DateTime?

companyId          String
company            Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

createdAt          DateTime     @default(now())
updatedAt          DateTime     @updatedAt

@@index([companyId])

@@map("payments")
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum PlanType {
FREE
BASIC
PROFESSIONAL
ENTERPRISE
}

enum Status {
ACTIVE
INACTIVE
SUSPENDED
}

enum UserRole {
ADMIN
MANAGER
USER
VIEWER
}

enum PaymentMethod {
CASH
CARD
UPI
NET_BANKING
RAZORPAY
}

enum PaymentStatus {
PENDING
SUCCESS
FAILED
REFUNDED
}
